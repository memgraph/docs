<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Memgraph Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Memgraph Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Memgraph Docs" href="/opensearch.xml">
<script src="https://docs.memgraph.com/js/analytics.js"></script><title data-react-helmet="true">Understanding music (with query modules) | Memgraph Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Understanding music (with query modules) | Memgraph Docs"><meta data-react-helmet="true" name="description" content="This article is part of a series intended to show users how to use Memgraph on"><meta data-react-helmet="true" property="og:description" content="This article is part of a series intended to show users how to use Memgraph on"><meta data-react-helmet="true" property="og:url" content="https://docs.memgraph.com/memgraph/tutorials/understanding-music-with-modules"><link data-react-helmet="true" rel="shortcut icon" href="/img/social-logo-round-corners.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://docs.memgraph.com/memgraph/tutorials/understanding-music-with-modules"><link rel="stylesheet" href="/styles.8ace48be.css">
<link rel="preload" href="/styles.06f88032.js" as="script">
<link rel="preload" href="/runtime~main.709d9e6c.js" as="script">
<link rel="preload" href="/main.afc0a334.js" as="script">
<link rel="preload" href="/1.0ef0cd43.js" as="script">
<link rel="preload" href="/2.cec97469.js" as="script">
<link rel="preload" href="/123.885e8308.js" as="script">
<link rel="preload" href="/126.8348d2a6.js" as="script">
<link rel="preload" href="/935f2afb.741916a7.js" as="script">
<link rel="preload" href="/17896441.a596db69.js" as="script">
<link rel="preload" href="/17af0db4.9f970165.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docs</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/memgraph/overview">Memgraph DB</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/memgraph/getting-started">Getting started</a></li><li><a class="dropdown__link" href="/memgraph/getting-started/installation">Installation</a></li><li><a class="dropdown__link" href="/memgraph/database-functionalities">Database functionalities</a></li><li><a class="dropdown__link" href="/memgraph/getting-started/connecting-applications">Building applications</a></li><li><a class="dropdown__link" href="/memgraph/reference-guide">Reference guide</a></li></ul></div><a class="navbar__item navbar__link" href="/memgraph-lab/">Memgraph Lab</a><a class="navbar__item navbar__link" href="/memgraph-cloud/">Memgraph Cloud</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/cypher-manual/">Cypher manual</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cypher-manual/">Overview</a></li><li><a class="dropdown__link" href="/cypher-manual/functions">Functions</a></li><li><a class="dropdown__link" href="/cypher-manual/clauses">Clauses</a></li><li><a class="dropdown__link" href="/cypher-manual/other-features">Other features</a></li><li><a class="dropdown__link" href="/cypher-manual/differences">Differences</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/memgraph" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/social-logo-round-corners.png" alt="Memgraph Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" role="button" href="/memgraph/overview">Memgraph DB</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/memgraph/getting-started">Getting started</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/database-functionalities">Database functionalities</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/getting-started/connecting-applications">Building applications</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/reference-guide">Reference guide</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/memgraph-lab/">Memgraph Lab</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph-cloud/">Memgraph Cloud</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/cypher-manual/">Cypher manual</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/functions">Functions</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/clauses">Clauses</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/other-features">Other features</a></li><li class="menu__list-item"><a class="menu__link" href="/cypher-manual/differences">Differences</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/memgraph" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/memgraph/overview">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started">Where to start?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation">Installation overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation/docker-installation">Docker (Windows, Linux, macOS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation/debian-installation">Debian GNU/Linux</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/installation/rpm-installation">RPM package</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Querying the database</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/querying/querying">Querying the database</a></li><li class="menu__list-item"><a href="https://docs.memgraph.com/memgraph-lab" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Memgraph Lab</a></li><li class="menu__list-item"><a href="https://playground.memgraph.com/" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Memgraph Playground</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Building applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications">Building applications</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/python">Python</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/rust">Rust</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/c-sharp">C#</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/java">Java</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/go">Go</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-started/connecting-applications/javascript">JavaScript</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/tutorials">Tutorials overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/analyzing-ted-talks">Analyzing TED Talks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/backpacking-through-europe">Backpacking through Europe</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/exploring-the-european-road-network">Exploring the European road network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/football-transfers">Football transfers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/graphing-the-premier-league">Graphing the Premier League</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/marvel-universe">Marvel Comic Universe social network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/movie-recommendation">Movie recommendation system</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/memgraph/tutorials/social-network-analysis">Social network analysis with NetworkX</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/memgraph/tutorials/understanding-music-with-modules">Understanding music (with query modules)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Database functionalities</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities">Database functionalities overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/import-data">Import data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/inspecting-queries">Inspecting queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/profiling-queries">Profiling queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/tensorflow-setup">TensorFlow Op</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/backup">Backup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Enforcing constraints</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/constraints/existence-constraint">Existence constraint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/constraints/uniqueness-constraint">Uniqueness constraint</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Query modules</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/query-modules/built-in-query-modules">Built-in query modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/query-modules/load-call-query-modules">Load and call custom query modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/query-modules/implement-query-modules">Implement custom query modules</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/manage-user-privileges">User privileges (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/manage-users-using-ldap">Authentication and authorization (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/database-functionalities/replication">Replication (Enterprise)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide">Reference guide overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/configuration">Memgraph configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/indexing">Indexing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/graph-algorithms">Graph algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/tensorflow">TensorFlow Op</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/backup">Backup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Query modules</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/query-modules">Query modules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/query-modules/c-api">C API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/query-modules/python-api">Python API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">NetworkX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx">NetworkX overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx/graph-analyzer">Graph Analyzer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx/nxalg">NetworkX Algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/networkx/wcc">Weakly Connected Components</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/security">Security (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/auth-module">Auth module (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/ldap-security">LDAP Security (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/audit-log">Audit log (Enterprise)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/reference-guide/replication">Replication (Enterprise)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts/storage">Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts/graph-algorithms">Graph algorithms</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/concepts/indexing">Indexing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Drivers</a><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/memgraph/mgclient" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">C/C++</a></li><li class="menu__list-item"><a href="https://github.com/memgraph/mgconsole" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">CLI Console</a></li><li class="menu__list-item"><a href="https://github.com/memgraph/pymgclient" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Python</a></li><li class="menu__list-item"><a href="https://github.com/memgraph/rsmgclient" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Rust</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/upcoming-features">Upcoming features</a></li><li class="menu__list-item"><a class="menu__link" href="/memgraph/changelog">Changelog</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-help/getting-help">Getting help</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/memgraph/getting-help/faq">FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Understanding music (with query modules)</h1></header><div class="markdown"><p>This article is part of a series intended to show users how to use Memgraph on
real-world data and, by doing so, retrieve some interesting and useful
information.</p><p>We highly recommend checking out the other articles from this series which
are listed in our <a href="/memgraph/tutorials/tutorials">tutorial overview section</a>.</p><h2 id="introduction">Introduction</h2><p>Getting useful information from your data is always challenging. With Memgraph,
you can manipulate and extract a huge amount of information by writing queries.
Memgraph even offers a set of built-in graph algorithms. You can use those algorithms
in your queries, extending your power over the data. But what if you wanted to do more?</p><p>At its core, Memgraph &quot;simply&quot; builds a graph from your data. Graphs were always
interesting to scientists and engineers because of their interesting properties
allowing you to represent a specific kind of data in an intuitive way which
makes extracting useful information much easier. A field called
graph theory emerged in mathematics, producing a great number of algorithms,
metrics, and other functions that are applied to the graphs.</p><p>Memgraph allows you to use the underlying graph in your functions by using
<code>Query modules</code>, and those functions are called procedures. In this tutorial,
we&#x27;ll see how easy it is to extend the capabilities of Memgraph using Python.
It will also show you how to use one of the most popular Python libraries for graphs,
called <a href="https://networkx.github.io/">NetworkX</a>, which contains an insane amount
of functions and algorithms for the graphs.</p><h2 id="data-model">Data model</h2><p>Social graphs is a relatively recent term. Simply said, it&#x27;s a representation of
a social network. Social networks appear in various sites, e.g., Youtube,
which is primarily a site for watching videos, can be classified as a social
network. For this tutorial, we&#x27;ll use data consisting of users of the music
streaming platform called <a href="https://www.deezer.com/">Deezer</a>.</p><p>The data consists of around 50k Deezer users from Croatia, but we prepared a
subset of the dataset only composed of 2k users. Each user is defined by id
and a list of genres he loved. The edges represent the mutual friendship between
the users. You can find a more detailed explanation of the dataset on the
<a href="https://github.com/benedekrozemberczki/datasets#deezer-social-networks">GitHub</a>
alongside many more similar datasets kindly provided by the same authors.</p><h2 id="importing-the-snapshot-and-defining-a-directory-with-user-modules">Importing the snapshot and defining a directory with user modules</h2><p>We have prepared a database snapshot for this example, so the user can easily
import it when starting Memgraph using the <code>--data-directory</code> option.</p><p>Also, we need to set up the directory from which the Memgraph will search for
the query modules by changing the <code>--query-modules-directory</code> flag in the main
configuration file(<code>/etc/memgraph/memgraph.conf</code>) or by supplying it as a
command-line parameter using the directory containing our modules as the value.
For a more detailed explanation take a look at
<a href="/memgraph/database-functionalities/query-modules/load-call-query-modules">Load and call query modules</a>.</p><pre><code class="language-plaintext">sudo -u memgraph \
  /usr/lib/memgraph/memgraph --data-directory /usr/share/memgraph/examples/Music \
   --storage-snapshot-interval-sec=0 --storage-wal-enabled=false \
   --storage-snapshot-on-exit=false --storage-properties-on-edges=true \
   --query-modules-directory=/modules
</code></pre><p>When using Memgraph installed from DEB or RPM package, the currently running
Memgraph server may need to be stopped before importing the example. The user
can do so using the following command:</p><pre><code class="language-plaintext">systemctl stop memgraph
</code></pre><p>When using Docker, the example can be imported with the following command
(notice how we need to mount the query module directory first):</p><pre><code class="language-plaintext">docker run -p 7687:7687 \
  -v mg_lib:/var/lib/memgraph -v mg_log:/var/log/memgraph -v mg_etc:/etc/memgraph \
  -v $(pwd)/modules:/modules \
  memgraph --data-directory /usr/share/memgraph/examples/Music \
  --storage-snapshot-interval-sec=0 --storage-wal-enabled=false \
  --storage-snapshot-on-exit=false --storage-properties-on-edges=true \
  --query-modules-directory=/modules
</code></pre><p>The user should note that any modifications of the database state will persist
only during this run of Memgraph.</p><h2 id="example-queries-and-procedures">Example queries and procedures</h2><p>First, let&#x27;s create a Python script in our modules directory which will contain
our procedures. We&#x27;ll name the script <code>deezer_example.py</code>.</p><p>After each change to the script, we need to tell Memgraph to reload all the
modules. We can do that by calling the following command:</p><pre><code class="language-cypher">CALL mg.load_all();
</code></pre><p>Let&#x27;s count how many times a specific genre occurs in our network!</p><p>We will define a procedure called <code>genre_count</code>:</p><pre><code class="language-python">import mgp


@mgp.read_proc
def genre_count(context: mgp.ProcCtx,
                genre: str) -&gt; mgp.Record(genre=str, count=int):
    count = len(
        [v for v in context.graph.vertices if genre in v.properties[&#x27;genres&#x27;]])
    return mgp.Record(genre=genre, count=count)
</code></pre><p>Let&#x27;s reload the modules and check the results:</p><pre><code class="language-cypher">CALL deezer_example.genre_count(&quot;Pop&quot;)
YIELD *;
</code></pre><p>We can notice multiple things:</p><ul><li>import of the <code>mgp</code> module which contains helper functions and types for
defining custom procedures</li><li><code>@mgp.read_proc</code> decorator which marks the function as a procedure</li><li>every argument is annotated with a type</li><li>result is defined as an object of <code>mgp.Record</code> which also has annotated types of
its members</li></ul><p>This example is probably not that interesting to you because we can get the same
result using the following query:</p><pre><code class="language-cypher">MATCH (n)
WITH n, &quot;Pop&quot; as genre
WHERE genre in n.genres
RETURN genre, count(n);
</code></pre><p>Let&#x27;s try something more interesting. The genres are listed in the order the
users have added them. If we assume that users picked the genres in order of
preference, let&#x27;s write a function that tells us in what percentage each genre
appears in top n places.</p><pre><code class="language-python">from collections import defaultdict


@mgp.read_proc
def in_top_n_percentage(context: mgp.ProcCtx,
                        n: int) -&gt; mgp.Record(genre=str,
                                              percentage=float,
                                              size=int):
    genre_count = defaultdict(lambda: {&#x27;total_count&#x27;: 0, &#x27;in_top_n_count&#x27;: 0})

    for v in context.graph.vertices:
        for index, genre in enumerate(v.properties[&#x27;genres&#x27;]):
            genre_count[genre][&#x27;total_count&#x27;] += 1
            genre_count[genre][&#x27;in_top_n_count&#x27;] += index &lt; n

    def get_record(genre, counts): return mgp.Record(
        genre=genre,
        percentage=counts[&#x27;in_top_n_count&#x27;] / counts[&#x27;total_count&#x27;],
        size=counts[&#x27;total_count&#x27;]
    )

    return [get_record(
        genre,
        counts) for genre,
        counts in genre_count.items()]
</code></pre><p>Let&#x27;s see what we got:</p><pre><code class="language-cypher">CALL deezer_example.in_top_n_percentage(3)
YIELD *
WITH genre, percentage, size
WHERE size &gt; 10
RETURN genre, percentage, size
ORDER BY percentage DESC;
</code></pre><p>As said in the introduction, we want to use the power of the graphs to extract
some useful information from our data which would be otherwise impossible. Most
of those functions are complex and writing them from scratch would be tedious.
As every modern programmer, we&#x27;ll just use a package that has everything we need
and more. To be precise, we&#x27;ll be using <code>NetworkX</code> that has a huge amount of
utility functions and graph algorithms implemented.</p><p>To use <code>NetworkX</code> algorithms we need to transform our graph to a type <code>NetworkX</code>
recognizes. In our case, we need to use an undirected graph <code>networkX.Graph</code>. To
make our lives easier, let&#x27;s write a helper function that transforms Memgraph
graph to <code>networkX.Graph</code>.</p><pre><code class="language-python">import networkx as nx
import networkx.algorithms as nxa


def _create_undirected_graph(context: mgp.ProcCtx) -&gt; nx.Graph:
    g = nx.Graph()

    for v in context.graph.vertices:
        context.check_must_abort()
        g.add_node(v)

    for v in context.graph.vertices:
        context.check_must_abort()
        for e in v.out_edges:
            g.add_edge(e.from_vertex, e.to_vertex)

    return g
</code></pre><p>Now let&#x27;s get some information about the graph. As our data represents social
network we would like to know if it has
<a href="https://tinyurl.com/y3angsdb">bridges</a> and we would
like to calculate the
<a href="https://en.wikipedia.org/wiki/Clustering_coefficient">average clustering</a>.</p><pre><code class="language-python">@mgp.read_proc
def analyze_graph(
        context: mgp.ProcCtx) -&gt; mgp.Record(
        average_clustering=float,
        has_bridges=bool):
    g = _create_undirected_graph(context)
    return mgp.Record(
        average_clustering=nxa.average_clustering(g),
        has_bridges=nxa.has_bridges(g))
</code></pre><p>And to get and display the data let&#x27;s run the following command:</p><pre><code class="language-cypher">CALL deezer_example.analyze_graph()
YIELD *;
</code></pre><p>Another interesting property of a node in a graph is its
<a href="https://en.wikipedia.org/wiki/Centrality">centrality</a>. Centrality tells us how
important a node is for a graph. In our case, it would mean higher the
centrality, the more popular the user is. Let&#x27;s find out which user is the most
popular in our network and take a peek at his/her music taste. We will use the
<a href="https://en.wikipedia.org/wiki/Betweenness_centrality">betweenness centrality</a>.</p><pre><code class="language-python">@mgp.read_proc
def betweenness_centrality(
        context: mgp.ProcCtx) -&gt; mgp.Record(node=mgp.Vertex,
                                            centrality=mgp.Number):
    g = _create_undirected_graph(context)
    return [mgp.Record(node=node, centrality=centrality)
            for node,
            centrality in nxa.centrality.betweenness_centrality(g).items()]
</code></pre><p>Now let&#x27;s take a look at the results:</p><pre><code>CALL deezer_example.betweenness_centrality()
YIELD *
RETURN node.id, node.genres, centrality
ORDER BY centrality DESC
LIMIT 10;
</code></pre><hr><p><strong>NOTE</strong></p><p>Calculating betweenness centrality for each node can take some time to
finish. The issue of slower <code>NetworkX</code> implementations is something we at
Memgraph would like to address in the future. An example of this can be seen
in the next section of this tutorial.</p><hr><p>For our last trick, let&#x27;s try to locate communities inside our network.
Communities are a set of nodes that are densely connected.
The goal of the community detection algorithms can be nicely described
with the next visualization:
<img src="/assets/images/community_detection_visualization-a7bacfdf4a83c423a48a363ad86b4080.png"></p><p>As for centrality, there are multiple algorithms for finding communities in a graph.
We will write a function that takes a method for calculating communities, uses it
to find the communities, and, optionally, calculates some metrics specific to
the graph partitioning so we can compare algorithms. To make things more
interesting, let&#x27;s find out which genre is the most popular in the community and
return the percentage which tells us how many of the users have that genre on
their list. In the end, music is something that connects us!</p><pre><code class="language-python">def _get_communities(
        context: mgp.ProcCtx,
        community_function,
        calculate_quality: bool):
    g = _create_undirected_graph(context)

    communities = list(community_function(g))

    if calculate_quality:
        quality = {
            &#x27;coverage&#x27;: nxa.community.quality.coverage(g, communities),
            &#x27;modularity&#x27;: nxa.community.quality.modularity(g, communities),
            &#x27;performance&#x27;: nxa.community.quality.performance(g, communities)
        }
    else:
        quality = {}

    communities = [list(community) for community in communities]

    def get_community_info(community):
        info = {
            &#x27;size&#x27;: len(community),
        }

        genre_count = defaultdict(lambda: 0)
        for genre in itertools.chain(
                *[user.properties[&quot;genres&quot;] for user in community]):
            genre_count[genre] += 1

        if len(genre_count) != 0:
            mpg = max(
                genre_count.items(),
                key=lambda item: item[1])

            info[&#x27;most_popular_genre&#x27;] = mpg[0]
            info[&#x27;most_popular_genre_percentage&#x27;] = mpg[1] / info[&#x27;size&#x27;]

        return info

    return mgp.Record(communities=[get_community_info(c)
                                   for c in communities], quality=quality)
</code></pre><p>Now that we have our function in place let&#x27;s test some algorithms. We will be
checking out community detection using
<a href="https://networkx.github.io/documentation/latest/reference/algorithms/generated/networkx.algorithms.community.modularity_max.greedy_modularity_communities.html#networkx.algorithms.community.modularity_max.greedy_modularity_communities">greedy modularity maximization by Clauset-Newman-Moore</a>
and
<a href="https://networkx.github.io/documentation/latest/reference/algorithms/generated/networkx.algorithms.community.label_propagation.label_propagation_communities.html#networkx.algorithms.community.label_propagation.label_propagation_communities">label propagation</a>.</p><pre><code class="language-python">@mgp.read_proc
def greedy_modularity_communities(
        context: mgp.ProcCtx,
        calculate_quality: bool = False) -&gt; mgp.Record(
        communities=list,
        quality=mgp.Map):
    return _get_communities(
        context,
        nxa.community.greedy_modularity_communities,
        calculate_quality)


@mgp.read_proc
def label_propagation_communities(
        context: mgp.ProcCtx,
        calculate_quality: bool = False) -&gt; mgp.Record(
        communities=list,
        quality=mgp.Map):
    return _get_communities(
        context,
        nxa.community.label_propagation_communities,
        calculate_quality)
</code></pre><p>In the above snippet, we can notice an optional argument <code>calculate_quality</code> and
usage of the type <code>mgp.Map</code> which is provided by Memgraph.</p><p>Let&#x27;s see the results with:</p><pre><code class="language-cypher">CALL deezer_example.greedy_modularity_communities()
YIELD communities
UNWIND communities as community
WITH community
WHERE community.size &gt; 10
RETURN community.most_popular_genre, community.most_popular_genre_percentage, community.size
ORDER BY community.size DESC;
</code></pre><p>and</p><pre><code class="language-cypher">CALL deezer_example.label_propagation_communities()
YIELD communities
UNWIND communities as community
WITH community
WHERE community.size &gt; 10
RETURN community.most_popular_genre, community.most_popular_genre_percentage, community.size
ORDER BY community.size DESC;
</code></pre><p>Your results should look something like this:
<img src="/assets/images/community_genre_statistics-8206eba0df0c16990e5c2151af0f726e.png"></p><p>Hmm, <code>Pop</code> sure is popular. Let&#x27;s ignore that genre:</p><pre><code class="language-python">for genre in itertools.chain(
        *[user.properties[&quot;genres&quot;] for user in community]):
    if genre != &#x27;Pop&#x27;:
        genre_count[genre] += 1
</code></pre><p>and call our procedures again for each algorithm. Well, people always liked to
dance!</p><p>We saw the biggest communities in our network using two different methods. It&#x27;s
hard to say which of the methods did better so let&#x27;s check a couple of metrics
by calling the same procedure with <code>calculate_quality</code> set to true:</p><pre><code class="language-cypher">CALL deezer_example.greedy_modularity_communities(true)
YIELD communities, quality
RETURN quality;
</code></pre><p>and</p><pre><code class="language-cypher">CALL deezer_example.label_propagation_communities(true)
YIELD communities, quality
RETURN quality;
</code></pre><p>I think it should come as no surprise that an algorithm that maximizes
modularity has higher modularity...</p><h2 id="optimized-networkx-integration">Optimized NetworkX integration</h2><p>As noted before, we at Memgraph are aware of NetworkX&#x27;s potential but the
performance for some functions isn&#x27;t that good. We decided to tackle this
problem by writing a wrapper object for Memgraph&#x27;s graph and with smarter usage
of NetworkX algorithms. To make things even more convenient, we decided to
implement procedures that call NetworkX functions with our graphs, so you have
out-of-the-box access to the graph algorithms. NetworkX contains a huge
amount of functions, and writing procedures for all of them require insane
effort, so don&#x27;t blame us if some of the algorithms aren&#x27;t available. We are
always open to any feedback, so if you think that an implementation for
an algorithm is needed, we will surely take that into account.</p><p>To demonstrate performance improvement, we will calculate the betweenness
centrality again, this time by using Memgraph&#x27;s procedure.</p><p>To get access to the NetworkX procedures, start your Memgraph server without
modifying the query modules directory path. That way, the path will be set to
the default path, which contains <code>nxalg</code> module.</p><p>Now let&#x27;s call the procedure:</p><pre><code class="language-cypher">CALL nxalg.betweenness_centrality()
YIELD *
RETURN node.id, node.genres, betweenness
ORDER BY betweenness DESC
LIMIT 10;
</code></pre><p>You should get the same results as with our previous procedure for
the betweenness centrality but in a much lower time.</p><h2 id="further-reading">Further reading</h2><p>We encourage you to take a look at our <code>How to</code> for the modules at the
<a href="/memgraph/database-functionalities/query-modules/implement-query-modules">How to Implement Query Modules?</a>.</p><p>This tutorial showed you how with a little effort you can extend your control
over the data. Using packages like <code>NetworkX</code> you get a huge amount of already
implemented graph algorithms while Memgraph allows you complete access to its
internal graph.</p><p>If you are not a big fan of Python, don&#x27;t worry! We have a C API with the exact
same functionalities.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/memgraph/docs/tree/main/docs/tutorials/understanding-music-with-modules.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/memgraph/tutorials/social-network-analysis"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Social network analysis with NetworkX</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/memgraph/database-functionalities"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Database functionalities overview Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#data-model" class="table-of-contents__link">Data model</a></li><li><a href="#importing-the-snapshot-and-defining-a-directory-with-user-modules" class="table-of-contents__link">Importing the snapshot and defining a directory with user modules</a></li><li><a href="#example-queries-and-procedures" class="table-of-contents__link">Example queries and procedures</a></li><li><a href="#optimized-networkx-integration" class="table-of-contents__link">Optimized NetworkX integration</a></li><li><a href="#further-reading" class="table-of-contents__link">Further reading</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Documentation</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/memgraph/overview">Memgraph DB</a></li><li class="footer__item"><a class="footer__link-item" href="/memgraph-lab">Memgraph Lab</a></li><li class="footer__item"><a class="footer__link-item" href="/memgraph-cloud">Memgraph Cloud</a></li><li class="footer__item"><a class="footer__link-item" href="/cypher-manual">Cypher manual</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/memgraphdb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discourse.memgraph.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Forum</a></li><li class="footer__item"><a href="https://twitter.com/memgraphdb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/memgraph" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCZ3HOJvHGxtQ_JHxOselBYg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://memgraph.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Memgraph Logo" src="/img/Memgraph-logo-white-rgb.png"></a></div><div class="footer__copyright">Copyright Â© 2021 Memgraph. Built by developers, for developers!</div></div></div></footer></div>
<script src="/styles.06f88032.js"></script>
<script src="/runtime~main.709d9e6c.js"></script>
<script src="/main.afc0a334.js"></script>
<script src="/1.0ef0cd43.js"></script>
<script src="/2.cec97469.js"></script>
<script src="/123.885e8308.js"></script>
<script src="/126.8348d2a6.js"></script>
<script src="/935f2afb.741916a7.js"></script>
<script src="/17896441.a596db69.js"></script>
<script src="/17af0db4.9f970165.js"></script>
</body>
</html>