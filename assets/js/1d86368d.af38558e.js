"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9185],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return u}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),m=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=m(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},s=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),s=m(n),u=r,h=s["".concat(p,".").concat(u)]||s[u]||c[u]||o;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=s;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var m=2;m<o;m++)i[m]=n[m];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}s.displayName="MDXCreateElement"},51198:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return m},toc:function(){return d},default:function(){return s}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],l={id:"docker-build",title:"Build a Docker image from the MAGE repository",sidebar_label:"Docker build"},p=void 0,m={unversionedId:"installation/docker-build",id:"installation/docker-build",title:"Build a Docker image from the MAGE repository",description:"This way, you will create a Docker image directly from the [MAGE Github",source:"@site/mage/installation/docker-build.md",sourceDirName:"installation",slug:"/installation/docker-build",permalink:"/docs/mage/installation/docker-build",editUrl:"https://github.com/memgraph/docs/tree/master/mage/installation/docker-build.md",tags:[],version:"current",frontMatter:{id:"docker-build",title:"Build a Docker image from the MAGE repository",sidebar_label:"Docker build"},sidebar:"mage",previous:{title:"Docker Hub (recommended)",permalink:"/docs/mage/installation/docker-hub"},next:{title:"Build from source on Linux",permalink:"/docs/mage/installation/source"}},d=[{value:"Installing MAGE",id:"installing-mage",children:[],level:2},{value:"Developing MAGE with Docker",id:"developing-mage-with-docker",children:[{value:"1. Rebuild the whole MAGE image",id:"1-rebuild-the-whole-mage-image",children:[],level:3},{value:"2. Build inside the Docker container",id:"2-build-inside-the-docker-container",children:[],level:3}],level:2}],c={toc:d};function s(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This way, you will create a Docker image directly from the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/memgraph/mage"},"MAGE Github\nrepository")," and won't have to pull it from\nDocker Hub. You can:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"download a ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/memgraph/mage/releases"},"specific release")," from\nthe MAGE repository or"),(0,o.kt)("li",{parentName:"ul"},"clone the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/memgraph/mage"},"repository")," for the latest\nversion.")),(0,o.kt)("p",null,"If you downloaded a specific release, skip the first step."),(0,o.kt)("h2",{id:"installing-mage"},"Installing MAGE"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"1.")," Download the MAGE source code from\n",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://github.com/memgraph/mage"},"GitHub")),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/memgraph/mage.git && cd mage\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"2.")," Build the ",(0,o.kt)("strong",{parentName:"p"},"MAGE")," tagged Docker image with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker build -t memgraph-mage .\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"3.")," Start Memgraph-MAGE with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker run --rm -p 7687:7687 --name mage memgraph-mage\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Now you can query Memgraph with any of the querying platforms like ",(0,o.kt)("a",{parentName:"p",href:"https://memgraph.com/product/lab"},"Memgraph\nLab")," or\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/memgraph/mgconsole"},"mgconsole"),"."),(0,o.kt)("p",{parentName:"div"},"If you made any changes while the ",(0,o.kt)("strong",{parentName:"p"},"MAGE")," Docker container was running, you\nwould need to stop the Docker container and rebuild the whole image. If you\ndon't want to repeat these steps each time, be sure to check the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/memgraph/mage#developing-mage-with-docker"},"Development\nprocess for MAGE with\nDocker"),"."))),(0,o.kt)("h2",{id:"developing-mage-with-docker"},"Developing MAGE with Docker"),(0,o.kt)("p",null,"When developing your query module, you need to load it inside Memgraph running\ninside the Docker container. You can do that by ",(0,o.kt)("a",{parentName:"p",href:"#1-rebuild-the-whole-mage-image"},"rebuilding the whole MAGE\nimage")," or by ",(0,o.kt)("a",{parentName:"p",href:"#2-build-inside-the-docker-container"},"building it inside the Docker\ncontainer"),"."),(0,o.kt)("h3",{id:"1-rebuild-the-whole-mage-image"},"1. Rebuild the whole MAGE image"),(0,o.kt)("p",null,"This command will trigger the rebuild of the whole Docker image. Make sure that\nyou have added Python requirements inside ",(0,o.kt)("inlineCode",{parentName:"p"},"python/requirements.txt")," file."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"1.")," Firstly, do the build of the ",(0,o.kt)("strong",{parentName:"p"},"MAGE")," image:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker build -t memgraph-mage .\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"2.")," Now, start ",(0,o.kt)("inlineCode",{parentName:"p"},"memgraph-mage")," image with the following command and enjoy\n",(0,o.kt)("strong",{parentName:"p"},"your")," own ",(0,o.kt)("strong",{parentName:"p"},"MAGE"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker run --rm -p 7687:7687 --name mage memgraph-mage\n")),(0,o.kt)("h3",{id:"2-build-inside-the-docker-container"},"2. Build inside the Docker container"),(0,o.kt)("p",null,"You can build a ",(0,o.kt)("strong",{parentName:"p"},"MAGE")," Docker image equipped for development. ",(0,o.kt)("inlineCode",{parentName:"p"},"Rust"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Clang"),",\n",(0,o.kt)("inlineCode",{parentName:"p"},"Python3-pip"),", and everything else necessary for development will still be\ninside the running container. This means that you can copy the ",(0,o.kt)("strong",{parentName:"p"},"MAGE"),"\nrepository to the container and do the build inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"mage")," container. There\nis no need to do the whole Docker image build again."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"1.")," To create ",(0,o.kt)("inlineCode",{parentName:"p"},"dev")," ",(0,o.kt)("strong",{parentName:"p"},"MAGE")," image, run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker build --target dev -t memgraph-mage:dev .\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"2.")," Then run the image with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker run --rm -p 7687:7687 --name mage memgraph-mage:dev\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"3.")," Next, copy the files inside the container and do the build:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"a)")," First, you need to copy the files to the container named ",(0,o.kt)("inlineCode",{parentName:"p"},"mage")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker cp . mage:/mage/\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"b)")," Then, you need to position yourself inside the container as root:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker exec -u root -it mage /bin/bash\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Note: If you have done the build locally, make sure to delete the directory\n",(0,o.kt)("inlineCode",{parentName:"p"},"cpp/build")," because you might be dealing with different ",(0,o.kt)("inlineCode",{parentName:"p"},"architectures")," or\nproblems with ",(0,o.kt)("inlineCode",{parentName:"p"},"CMakeCache.txt"),". To delete it, run:"),(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"rm -rf cpp/build")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"c)")," After that, run build and copy ",(0,o.kt)("inlineCode",{parentName:"p"},"mage/dist")," to\n",(0,o.kt)("inlineCode",{parentName:"p"},"/usr/lib/memgraph/query_modules"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"python3 setup build -p /usr/lib/memgraph/query_modules/\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"d)")," Everything should be ready, and you can run the following command to exit\nthe container:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"exit\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Note that query modules are loaded into Memgraph on startup, so if your instance\nwas already running, you would need to execute the following query inside one of\nthe ",(0,o.kt)("a",{parentName:"p",href:"https://memgraph.com/docs/memgraph/connect-to-memgraph"},"querying platforms"),"\nto load them:"),(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"CALL mg.load_all();")))))}s.isMDXComponent=!0}}]);