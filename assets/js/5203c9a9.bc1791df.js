"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[99873],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=p(a),h=r,m=u["".concat(s,".").concat(h)]||u[h]||c[h]||i;return a?n.createElement(m,l(l({ref:t},d),{},{components:a})):n.createElement(m,l({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},24146:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const i={id:"analyze-graph",title:"Analyze graph",sidebar_label:"Analyze graph"},l=void 0,o={unversionedId:"reference-guide/analyze-graph",id:"reference-guide/analyze-graph",title:"Analyze graph",description:"Until Memgraph v2.7, the database would choose an index solely based on the number of indexed nodes. But if the number of nodes is the only condition, in some cases the database would choose a non-optimal index. With the ANALYZE GRAPH query, Memgraph analyzes the distribution of property values and can select a more optimal label-property index, the one with the smallest average property value size.",source:"@site/docs/reference-guide/analyze_graph.md",sourceDirName:"reference-guide",slug:"/reference-guide/analyze-graph",permalink:"/docs/memgraph/next/reference-guide/analyze-graph",draft:!1,editUrl:"https://github.com/memgraph/docs/tree/master/docs/reference-guide/analyze_graph.md",tags:[],version:"current",frontMatter:{id:"analyze-graph",title:"Analyze graph",sidebar_label:"Analyze graph"},sidebar:"memgraph",previous:{title:"Reference guide overview",permalink:"/docs/memgraph/next/reference-guide"},next:{title:"Built-in graph algorithms",permalink:"/docs/memgraph/next/reference-guide/built-in-graph-algorithms"}},s={},p=[{value:"Calculate the statistic",id:"calculate-the-statistic",level:2},{value:"Delete statistic",id:"delete-statistic",level:2}],d={toc:p};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Until Memgraph v2.7, the database would choose an index solely based on the number of indexed nodes. But if the number of nodes is the only condition, in some cases the database would choose a non-optimal index. With the ",(0,r.kt)("inlineCode",{parentName:"p"},"ANALYZE GRAPH")," query, Memgraph analyzes the distribution of property values and can select a more optimal label-property index, the one with the smallest average property value size. "),(0,r.kt)("p",null,"The average property value's group size directly represents the database's expected number of hits which can be used to estimate the query's cost. When the average group size is the same, the chi-squared statistic is used to measure how close the distribution of property-value group size is to the uniform distribution. The index with a distribution closest to the uniform distribution is selected."),(0,r.kt)("a",{href:"https://latex.codecogs.com/gif.image?\\dpi{110}\\chi^2&space;=&space;\\sum_{i}\\frac{(E_i-O_i)^2}{E_i}",target:"_blank"},(0,r.kt)("img",{src:"https://latex.codecogs.com/gif.image?\\dpi{110}\\chi^2&space;=&space;\\sum_{i}\\frac{(E_i-O_i)^2}{E_i}",title:"Chi-squared statistic"})),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ANALYZE GRAPH;")," command should be run only once after all indexes have been created and nodes inserted in the database. In rare situations when one property is set on many more nodes than another property, choosing an index based on average group size and uniform distribution would be misleading. That's why the database always selects the label-property index with >= 10x fewer nodes than the other label-property index."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ANALYZE GRAPH;")," command analyses only label-property indices, so whenever the database contains only label indices, the information about the distribution and average group size is ignored, and the optimal index is selected based on the number of nodes it contains."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/memgraph/next/how-to-guides/indexes"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/static/v1?label=Related&message=How-to&color=blue&style=for-the-badge",alt:"Related - How\nto"})),"\n",(0,r.kt)("a",{parentName:"p",href:"/docs/memgraph/next/under-the-hood/indexing"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/static/v1?label=Related&message=Under%20the%20hood&color=orange&style=for-the-badge",alt:"Related - Under the\nHood"})),"\n",(0,r.kt)("a",{parentName:"p",href:"https://memgraph.com/blog/implementing-data-replication"},(0,r.kt)("img",{parentName:"a",src:"https://img.shields.io/static/v1?label=Related&message=Blog%20post&color=9C59DB&style=for-the-badge",alt:"Related - Blog\nPost"}))),(0,r.kt)("h2",{id:"calculate-the-statistic"},"Calculate the statistic"),(0,r.kt)("p",null,"Run the following query to calculate the statistics:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cypher"},"ANALYZE GRAPH;\n")),(0,r.kt)("p",null,"The query will iterate over all label-property indices in the database and calculate the average group size and chi-squared statistic for each one, then return the following output:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"label"),(0,r.kt)("th",{parentName:"tr",align:null},"property"),(0,r.kt)("th",{parentName:"tr",align:null},"num estimation nodes"),(0,r.kt)("th",{parentName:"tr",align:null},"num groups"),(0,r.kt)("th",{parentName:"tr",align:null},"avg group size"),(0,r.kt)("th",{parentName:"tr",align:null},"chi-squared value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"index's label"),(0,r.kt)("td",{parentName:"tr",align:null},"index's property"),(0,r.kt)("td",{parentName:"tr",align:null},"number of nodes used for estimation"),(0,r.kt)("td",{parentName:"tr",align:null},"number of distinct values the property contains"),(0,r.kt)("td",{parentName:"tr",align:null},"average group size of property's values"),(0,r.kt)("td",{parentName:"tr",align:null},"value of the chi-squared statistic")))),(0,r.kt)("p",null,"Once the information about the average group size and the chi-squared statistic is obtained, Memgraph can choose the optimal index.\nIf you don't want to run analysis on all labels, you can specify which labels to use by adding the labels to the query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cypher"},"ANALYZE GRAPH ON LABELS :Label1, :Label2;\n")),(0,r.kt)("h2",{id:"delete-statistic"},"Delete statistic"),(0,r.kt)("p",null,"If you want the database to ignore information about the average group size and the chi-squared statistic, the existing statistic can be deleted by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cypher"},"ANALYZE GRAPH DELETE STATISTICS;\n")),(0,r.kt)("p",null,"The results will contain all label-property indices that were successfully deleted:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"label"),(0,r.kt)("th",{parentName:"tr",align:null},"property"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"index's label"),(0,r.kt)("td",{parentName:"tr",align:null},"index's property")))),(0,r.kt)("p",null,"Specific labels can be specified with the construct ",(0,r.kt)("inlineCode",{parentName:"p"},"ON LABELS"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cypher"},"ANALYZE GRAPH ON LABELS :Label1 DELETE STATISTICS;\n")))}c.isMDXComponent=!0}}]);