"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[16223],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>c});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var u=n.createContext({}),s=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},d=function(e){var t=s(e.components);return n.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),m=s(r),c=o,h=m["".concat(u,".").concat(c)]||m[c]||p[c]||a;return r?n.createElement(h,l(l({ref:t},d),{},{components:r})):n.createElement(h,l({ref:t},d))}));function c(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,l=new Array(a);l[0]=m;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var s=2;s<a;s++)l[s]=r[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},41478:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>s});var n=r(87462),o=(r(67294),r(3905));const a={id:"query-modules",title:"How to use query modules",sidebar_label:"Use query modules",slug:"/how-to-guides/query-modules"},l=void 0,i={unversionedId:"how-to-guides/query-modules",id:"version-2.7.0/how-to-guides/query-modules",title:"How to use query modules",description:"Related - Reference Guide",source:"@site/memgraph_versioned_docs/version-2.7.0/how-to-guides/query-modules.md",sourceDirName:"how-to-guides",slug:"/how-to-guides/query-modules",permalink:"/docs/memgraph/how-to-guides/query-modules",draft:!1,editUrl:"https://github.com/memgraph/docs/tree/master/memgraph_versioned_docs/version-2.7.0/how-to-guides/query-modules.md",tags:[],version:"2.7.0",frontMatter:{id:"query-modules",title:"How to use query modules",sidebar_label:"Use query modules",slug:"/how-to-guides/query-modules"},sidebar:"memgraph",previous:{title:"Use Font Awesome for node images",permalink:"/docs/memgraph/how-to-guides/font-awesome-for-node-images"},next:{title:"Use SSL encryption",permalink:"/docs/memgraph/how-to-guides/encryption"}},u={},s=[{value:"How to import the MAGE library and its query modules into Memgraph?",id:"how-to-import-the-mage-library-and-its-query-modules-into-memgraph",level:2},{value:"How to implement custom query modules?",id:"how-to-implement-custom-query-modules",level:2},{value:"How to install external Python libraries?",id:"how-to-install-external-python-libraries",level:2},{value:"How to list all loaded .py query modules?",id:"how-to-list-all-loaded-py-query-modules",level:2},{value:"How to list all loaded procedures, user-defined functions and their signatures?",id:"how-to-list-all-loaded-procedures-user-defined-functions-and-their-signatures",level:2},{value:"How to load a query module?",id:"how-to-load-a-query-module",level:2},{value:"How to call a query module procedure?",id:"how-to-call-a-query-module-procedure",level:2},{value:"How to call a user-defined function?",id:"how-to-call-a-user-defined-function",level:2},{value:"How to control the memory usage of a procedure?",id:"how-to-control-the-memory-usage-of-a-procedure",level:2},{value:"How to change the default query module directories?",id:"how-to-change-the-default-query-module-directories",level:2}],d={toc:s};function p(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/memgraph/reference-guide/query-modules"},(0,o.kt)("img",{parentName:"a",src:"https://img.shields.io/static/v1?label=Related&message=Reference%20Guide&color=yellow&style=for-the-badge",alt:"Related - Reference Guide"}))," "),(0,o.kt)("p",null,"Query modules are extensions of the Cypher query language. They are groups of\nprocedures and functions written in ",(0,o.kt)("strong",{parentName:"p"},"C"),", ",(0,o.kt)("strong",{parentName:"p"},"C++"),", ",(0,o.kt)("strong",{parentName:"p"},"Python"),", and ",(0,o.kt)("strong",{parentName:"p"},"Rust")," and\nbundled up in either ",(0,o.kt)("inlineCode",{parentName:"p"},"*.so")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"*.py")," query modules files."),(0,o.kt)("p",null,"Some query modules are built-in, and others, like those that can help you solve\ncomplex graph issues, are available as part of the MAGE library you can add to\nyour Memgraph installation. The library is already included if you are using\nMemgraph Platform or Memgraph MAGE Docker images to run Memgraph."),(0,o.kt)("p",null,"You can also implement custom query modules."),(0,o.kt)("p",null,"Regardless of where they come from and who wrote them, all modules need to be\nloaded into Memgraph so that they can be called while querying the database.\nThey are either loaded automatically when Memgraph starts or manually if they\nwere added while Memgraph was already running."),(0,o.kt)("p",null,"On this page, you will find the answers to the following questions regarding\nquery modules:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-import-the-mage-library-and-its-query-modules-into-memgraph"},"How to import the MAGE library and its query modules into\nMemgraph?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-implement-custom-query-modules"},"How to implement custom query\nmodules?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-install-external-python-libraries"},"How to install external Python packages?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-list-all-loaded-py-query-modules"},"How to list all loaded .py query\nmodules?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-list-all-loaded-procedures-and-their-signatures"},"How to list all loaded procedures and their\nsignatures?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-load-a-query-module"},"How to load a query module?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-call-a-query-module-procedure"},"How to call a query module procedure?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-control-the-memory-usage-of-a-procedure"},"How to control the memory usage of a\nprocedure?")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-change-the-default-query-module-directories"},"How to change the default query module\ndirectories?"))),(0,o.kt)("h2",{id:"how-to-import-the-mage-library-and-its-query-modules-into-memgraph"},"How to import the MAGE library and its query modules into Memgraph?"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/mage"},(0,o.kt)("strong",{parentName:"a"},"Memgraph Advanced Graph Extensions")),", ",(0,o.kt)("strong",{parentName:"p"},"MAGE")," to friends, is an\nopen-source repository that contains graph algorithms and procedures as query\nmodules, thus giving everyone the tools they need to tackle the most interesting\nand challenging graph analytics problems."),(0,o.kt)("p",null,"If you installed Memgraph with Docker using the ",(0,o.kt)("inlineCode",{parentName:"p"},"memgraph-platform")," or\n",(0,o.kt)("inlineCode",{parentName:"p"},"memgraph-mage")," images, the MAGE library is already loaded into Memgraph, and\nyou can proceed ",(0,o.kt)("a",{parentName:"p",href:"#how-to-call-a-query-module-procedure"},"to call any of the available\nprocedures"),"."),(0,o.kt)("p",null,"Otherwise, please check the ",(0,o.kt)("a",{parentName:"p",href:"/mage/installation"},"MAGE installation guide"),"."),(0,o.kt)("h2",{id:"how-to-implement-custom-query-modules"},"How to implement custom query modules?"),(0,o.kt)("p",null,"If you need to expand the Cypher language with custom procedures, Memgraph\nprovides public APIs for writing custom query modules in Python, C/C++ and Rust."),(0,o.kt)("p",null,"Please check ",(0,o.kt)("a",{parentName:"p",href:"../reference-guide/query-modules/implement-custom-query-modules/overview"},"the reference guide on implementing custom query\nmodules"),"\nthat will provide you with the C and Python APIs and ",(0,o.kt)("a",{parentName:"p",href:"../reference-guide/query-modules/implement-custom-query-modules/custom-query-module-example"},"give an\nexample"),"\nto help you start implementing a custom query module."),(0,o.kt)("p",null,"You can develop query modules in Python directly from Memgraph Lab (v2.0 or\nnewer). To start, just navigate to ",(0,o.kt)("strong",{parentName:"p"},"Query Modules")," and click on ",(0,o.kt)("strong",{parentName:"p"},"New\nModule"),"."),(0,o.kt)("img",{src:r(43739).Z,className:"imgBorder"}),(0,o.kt)("p",null,"If you want to use an external Python library, read ",(0,o.kt)("a",{parentName:"p",href:"#how-to-install-external-python-libraries"},"instructions on how to install it"),"."),(0,o.kt)("h2",{id:"how-to-install-external-python-libraries"},"How to install external Python libraries?"),(0,o.kt)("p",null,"It is possible to install Python libraries that are not already included with\nMemgraph installation. For example, to install ",(0,o.kt)("inlineCode",{parentName:"p"},"pandas")," with Memgraph running\ninside a ",(0,o.kt)("strong",{parentName:"p"},"Docker")," container, run the following command in the terminal:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'docker exec -i -u root <container_id> bash -c "apt install -y python3-pip &&\npip install pandas"\n')),(0,o.kt)("p",null,"Don't forget to replace ",(0,o.kt)("inlineCode",{parentName:"p"},"<container_id>")," with the appropriate value,\nwhich you can find by running ",(0,o.kt)("inlineCode",{parentName:"p"},"docker ps")," command in the terminal. "),(0,o.kt)("p",null,"If you are starting Memgraph with ",(0,o.kt)("strong",{parentName:"p"},"Docker Compose"),", write the following commands\nin the Dockerfile:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"FROM memgraph/memgraph:latest\n\nUSER root\n\nRUN apt install -y python3-pip\nRUN pip install pandas\n\nUSER memgraph\n")),(0,o.kt)("p",null,"It is important that you install Python library as a ",(0,o.kt)("inlineCode",{parentName:"p"},"root")," user, rather than the default ",(0,o.kt)("inlineCode",{parentName:"p"},"memgraph")," user. "),(0,o.kt)("h2",{id:"how-to-list-all-loaded-py-query-modules"},"How to list all loaded .py query modules?"),(0,o.kt)("p",null,"To list the value of an ",(0,o.kt)("inlineCode",{parentName:"p"},"is_editable")," flag and the absolute path of each Python\nquery module file in all the query module directories, run the following query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"CALL mg.get_module_files() YIELD *;\n")),(0,o.kt)("p",null,"Check the reference guide for more ",(0,o.kt)("a",{parentName:"p",href:"/docs/memgraph/reference-guide/query-modules/module-file-utilities"},"utility procedures for query\nmodules"),"."),(0,o.kt)("h2",{id:"how-to-list-all-loaded-procedures-user-defined-functions-and-their-signatures"},"How to list all loaded procedures, user-defined functions and their signatures?"),(0,o.kt)("p",null,"To list loaded procedures and their signatures, run the following query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"CALL mg.procedures() YIELD *;\n")),(0,o.kt)("p",null,"On the other side, if you are interested in listing all user-defined functions,\nrun this query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"CALL mg.functions() YIELD *;\n")),(0,o.kt)("p",null,"Check the reference guide for more ",(0,o.kt)("a",{parentName:"p",href:"/docs/memgraph/reference-guide/query-modules/module-file-utilities"},"utility procedures for query\nmodules"),"."),(0,o.kt)("h2",{id:"how-to-load-a-query-module"},"How to load a query module?"),(0,o.kt)("p",null,"Upon startup, Memgraph will attempt to load the query modules from all ",(0,o.kt)("inlineCode",{parentName:"p"},"*.so"),"\nand ",(0,o.kt)("inlineCode",{parentName:"p"},"*.py")," files it finds in the default query module directories\n(",(0,o.kt)("inlineCode",{parentName:"p"},"/usr/lib/memgraph/query_modules")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/lib/memgraph/internal_modules"),")."),(0,o.kt)("p",null,"You can also (re)load all or specific modules manually."),(0,o.kt)("p",null,"To (re)load all query modules in all the query module directories, run the\nfollowing query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"CALL mg.load_all();\n")),(0,o.kt)("p",null,"If the response is an ",(0,o.kt)("inlineCode",{parentName:"p"},"Empty set (x.x sec)")," and there are no error messages, the\nupdate was successful."),(0,o.kt)("p",null,"To (re)load a specific module, run the following query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},'CALL mg.load("py_example");\n')),(0,o.kt)("p",null,"If the response is an ",(0,o.kt)("inlineCode",{parentName:"p"},"Empty set (x.x sec)")," and there are no error messages, the\nupdate was successful."),(0,o.kt)("p",null,"For more information on loading procedures please read the ",(0,o.kt)("a",{parentName:"p",href:"../reference-guide/query-modules/load-call-query-modules#loading-query-modules"},"reference\nguide"),"."),(0,o.kt)("h2",{id:"how-to-call-a-query-module-procedure"},"How to call a query module procedure?"),(0,o.kt)("p",null,"Each query module file corresponds to one query module, and file names are\nmapped as query module names. For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"example.so")," will be mapped as\n",(0,o.kt)("inlineCode",{parentName:"p"},"example")," module, and ",(0,o.kt)("inlineCode",{parentName:"p"},"py_example.py")," will be mapped as ",(0,o.kt)("inlineCode",{parentName:"p"},"py_example")," module. If\neach module file has a procedure called ",(0,o.kt)("inlineCode",{parentName:"p"},"procedure")," defined, those procedures\nwould be mapped in the Cypher query language as ",(0,o.kt)("inlineCode",{parentName:"p"},"example.procedure()")," and\n",(0,o.kt)("inlineCode",{parentName:"p"},"py_example.procedure()"),", respectively."),(0,o.kt)("p",null,"The syntax for calling procedures in loaded query modules is:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"CALL module.procedure(arg1, arg2, ...) YIELD res1, res2, ...;\n")),(0,o.kt)("p",null,"Each procedure returns zero or more records, where each record contains named\nfields. The ",(0,o.kt)("inlineCode",{parentName:"p"},"YIELD")," part is used to select fields we are interested in. If the\nprocedure doesn't return any fields, the ",(0,o.kt)("inlineCode",{parentName:"p"},"YIELD")," part can be omitted."),(0,o.kt)("p",null,"Procedures can also be a part of a larger query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"MATCH (node) CALL module.procedure(node) YIELD result RETURN *;\n")),(0,o.kt)("p",null,"For more information and constrictions on calling procedures, please read the\n",(0,o.kt)("a",{parentName:"p",href:"../reference-guide/query-modules/load-call-query-modules#calling-query-modules"},"reference\nguide"),"."),(0,o.kt)("h2",{id:"how-to-call-a-user-defined-function"},"How to call a user-defined function?"),(0,o.kt)("p",null,"Similarly, query procedure rules apply to the functions. Although their context\nis different, the mechanism behind functions maps the written functions to\n",(0,o.kt)("inlineCode",{parentName:"p"},"example.function()")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"py_example.function()")," respectively, just as was the\ncase above."),(0,o.kt)("p",null,"The syntax for calling functions in loaded query modules is similar to the\nbuilt-in functions, with the difference being case sensitivity. User-defined\nfunctions do have a case sensitive name, while builtin ones don't:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"RETURN example.function();\n")),(0,o.kt)("p",null,"Since functions do not require a heavy context around them, they are easily\nnested and combined with other Cypher syntax."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"MATCH (node) CALL module.procedure(module.function(node)) YIELD result RETURN ABS(result);\n")),(0,o.kt)("h2",{id:"how-to-control-the-memory-usage-of-a-procedure"},"How to control the memory usage of a procedure?"),(0,o.kt)("p",null,"When a procedure cannot yield results using the default 100 MB, you can increase\nthe maximum memory usage by adding the following clause in the query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cypher"},"CALL module.procedure(arg1, arg2, ...) PROCEDURE MEMORY LIMIT 100 KB YIELD res1, res2, ...;\nCALL module.procedure(arg1, arg2, ...) PROCEDURE MEMORY LIMIT 100 MB YIELD res1, res2, ...;\nCALL module.procedure(arg1, arg2, ...) PROCEDURE MEMORY UNLIMITED YIELD res1, res2, ...;\n")),(0,o.kt)("p",null,"The limit can be specified to a specific value (in ",(0,o.kt)("inlineCode",{parentName:"p"},"KB")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"MB"),") or set to\n",(0,o.kt)("inlineCode",{parentName:"p"},"UNLIMITED"),"."),(0,o.kt)("p",null,"For more information on controlling the memory usage of procedures please read\nthe ",(0,o.kt)("a",{parentName:"p",href:"../reference-guide/query-modules/load-call-query-modules#controlling-procedure-memory-usage"},"reference\nguide"),"."),(0,o.kt)("h2",{id:"how-to-change-the-default-query-module-directories"},"How to change the default query module directories?"),(0,o.kt)("p",null,"If you want to change the default query module directories\n(",(0,o.kt)("inlineCode",{parentName:"p"},"/usr/lib/memgraph/query_modules")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/lib/memgraph/internal_modules"),"),\nthat is, the directories in which Memgraph searches for query modules, change\nthe ",(0,o.kt)("inlineCode",{parentName:"p"},"--query-modules-directory")," flag in the main configuration file\n(",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/memgraph/memgraph.conf"),") or supply it as a command-line parameter (e.g.\nwhen using Docker)."),(0,o.kt)("p",null,"You can find all the ",(0,o.kt)("a",{parentName:"p",href:"../reference-guide/configuration"},"configuration settings"),"\nin the reference guide or check our guide on ",(0,o.kt)("a",{parentName:"p",href:"./config-logs"},"how to change the Memgraph\nconfiguration"),"."))}p.isMDXComponent=!0},43739:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/memgraph_lab_query_modules-e5619e8b4b458425c680c0ce3cefb22c.png"}}]);